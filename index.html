<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Téléchargement base64</title>
</head>
<body>
<script>
  // Récupère le paramètre "data" de l'URL
  const params = new URLSearchParams(window.location.search);
  const base64 = params.get("data");
  const filename = params.get("name") || "fichier.bin";
  const mime = params.get("mime") || "application/octet-stream";

  if (!base64) {
    document.body.innerHTML = "<h3>Ajoute ?data=... dans l'URL</h3>";
  } else {
    try {
      // Conversion base64 → binaire
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);
      for (let i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i);
      }
      const blob = new Blob([bytes], { type: mime });
      const url = URL.createObjectURL(blob);

      // Création du lien et déclenchement du téléchargement
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      document.body.innerHTML = `<p>Le fichier <b>${filename}</b> a été téléchargé.</p>`;
    } catch (e) {
      document.body.innerHTML = "<p style='color:red'>Erreur : base64 invalide</p>";
    }
  }
</script>
</body>
</html>
